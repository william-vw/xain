<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="lib/rdflib/rdflib.min.js"></script>
    <script src="https://eyereasoner.github.io/eye-js/latest/index.js"></script>
    <script src="lib/eye_aux.js"></script>
    <script src="lib/mod4n3.js"></script>
    <script src="lib/explain.js"></script>

    <title>XAIN</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
</head>

<body>
    <script type="module">
        let start = performance.now();

        // const type = 'trace';
        const type = 'contrast';

        const usecase = 'copd';
        // const usecase = 'rheumatology';

        let proof = await explain(type, usecase);

        let end = performance.now();
        console.log("total time :-(", (end - start));

        // console.log(proof);

        let store = $rdf.graph();
        let mimeType = 'text/n3';
        try {
            $rdf.parse(proof, store, "http://wvw.org/xai#", mimeType)
        } catch (err) {
            console.log(err)
        }

        // example: navigate the "proof tree"

        const rdf = $rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");
        const x = $rdf.Namespace("http://wvw.org/xai#");

        // (print entire store contents)
        // for (let stmt of store.statementsMatching(undefined, undefined, undefined)) {
        //     console.log(stmt);
        // }

        let root = store.any(null, rdf("type"), x("RootNode"));
        recurseTree(root);

        function recurseTree(node) {
            let evidences = store.any(node, x("evidence"), null);
            let inference = store.any(node, x("gives"), null);
            console.log(node.localName(), printGraph(inference));
            for (let evidence of evidences.elements) {
                recurseTree(evidence);
            }
        }

        function printGraph(graph) {
            return graph.statements.map(t => t.subject.value + " " + t.predicate.value + " " + t.object.value).join("\n");
        }

    </script>

</body>

</html>